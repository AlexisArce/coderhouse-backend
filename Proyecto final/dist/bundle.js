(()=>{"use strict";var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=require("express");var r=t.n(e);const o=require("fs");var s=t.n(o);const a=require("lodash");var n=t.n(a);function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const c=class{constructor(t){i(this,"save",(async t=>{try{const e=await this.getAll();if(!t.id){const r=n().maxBy(e,"id");r&&(t.id=(r.id||0)+1)}e.push(t);const r=JSON.stringify(e,null,2);return await s().promises.writeFile(this.filePath,r,"utf-8"),t}catch(t){console.error(t)}})),i(this,"update",(async t=>{try{const e=await this.getAll(),r=n().findIndex(e,(e=>e.id==t.id));e[r].title=t.title,e[r].price=t.price;const o=JSON.stringify(e,null,2);return await s().promises.writeFile(this.filePath,o,"utf-8"),t}catch(t){console.error(t)}})),i(this,"updateCart",(async t=>{try{const e=await this.getAll();e[n().findIndex(e,(e=>e.id==t.id))].products=t.products;const r=JSON.stringify(e,null,2);return await s().promises.writeFile(this.filePath,r,"utf-8"),t}catch(t){console.error(t)}})),i(this,"getById",(async t=>(await this.getAll()).find((e=>e.id==t)))),i(this,"getAll",(async()=>{try{return JSON.parse(await s().promises.readFile(this.filePath,"utf-8")||"[]")}catch(t){console.error(t)}})),i(this,"deleteById",(async t=>{try{const e=(await this.getAll()).filter((e=>e.id!=t)),r=JSON.stringify(e,null,2);await s().promises.writeFile(this.filePath,r,"utf-8")}catch(t){console.error(t)}})),i(this,"deleteAll",(async()=>{try{const t=JSON.stringify([]);await s().promises.writeFile(this.filePath,t,"utf-8")}catch(t){console.error(t)}})),this.filePath=t}},d=require("path");function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function l(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const{Router:p}=r(),y=new p,f=new c(d.resolve(__dirname,"../data","products.json"));y.get("/",(async(t,e)=>{const r=await f.getAll();e.json(r)})),y.get("/:id",(async(t,e)=>{const r=await f.getById(t.params.id);r?e.send(r):e.status(404).json({error:"producto no encontrado"})})),y.post("/",(async(t,e)=>{if(t.body.title){const r=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){l(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t.body),o=await f.save(r);e.status(201).send(o)}else e.status(400).send({error:"debe indicar el nombre del producto"})})),y.put("/:id",(async(t,e)=>{const r=await f.getById(t.params.id);r||e.status(404).json({error:"producto no encontrado"}),r.title=t.body.title,r.price=t.body.price,await f.update(r),e.send("producto actualizado")})),y.delete("/:id",(async(t,e)=>{const r=await f.getById(t.params.id);r||e.status(404).json({error:"producto no encontrado"}),f.deleteById(r.id),e.send("producto eliminado")}));const w=y,g=require("uuid"),{Router:h}=r(),b=new h,j=new c(d.resolve(__dirname,"../data","carts.json"));b.get("/",(async(t,e)=>{const r=await j.getAll();e.json(r)})),b.get("/:id",(async(t,e)=>{const r=await j.getById(t.params.id);if(r)return e.send(r);e.status(404).json({error:"carrito no encontrado"})})),b.get("/:id/productos",(async(t,e)=>{const r=await j.getById(t.params.id);if(r)return e.send(r.products);e.status(404).json({error:"carrito no encontrado"})})),b.post("/",(async(t,e)=>{const r={id:(0,g.v4)(),products:[]};await j.save(r),e.status(201).json({id:r.id})})),b.delete("/:id",(async(t,e)=>{const r=await j.getById(t.params.id);r||e.status(404).json({error:"carrito no encontrado"}),j.deleteById(r.id),e.send("carrito eliminado")})),b.post("/:id/productos",(async(t,e)=>{const r=await j.getById(t.params.id);r||e.status(404).json({error:"carrito no encontrado"}),t.body.products&&t.body.products.length?(r.products=[...r.products,...t.body.products],await j.updateCart(r),e.status(201).json({msg:"los productos fueron agregados al carrito"})):e.status(400).json({error:"Debe enviar una lista de productos vÃ¡lida"})})),b.delete("/:id/productos/:id_prod",(async(t,e)=>{const r=await j.getById(t.params.id);r||e.status(404).json({error:"carrito no encontrado"}),r.products.find((e=>e.id==t.params.id_prod))||e.status(404).json({error:"producto no encontrado en el carrito"});const o=r.products.filter((e=>e.id!=t.params.id_prod));r.products=o,await j.updateCart(r),e.send("producto eliminado del carrito")}));const m=b,O=r()(),v=process.env.PORT||8080;O.use(r().json()),O.use(r().urlencoded({extended:!0})),O.use(r().static("public")),O.use("/api/carrito",m),O.use("/api/productos",w),O.listen(v,(()=>{console.log(`"server is running on port ${v}`)}))})();